<!--
# Copyright (c) 2020 PaddlePaddle Authors. All Rights Reserved.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
-->

<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>欢迎使用 PaddleX RestfulAPI Demo示例程序</title>

<style type="text/css">
h1{
  font:400 40px 'pt sans',sans-serif;
  text-align:center;
}
.nav a{
  text-decoration:none;
}
.nav{
  height:70px;
  background:#0000cd;
  position:relative;
  z-index:6;
}
.nav>ul{
  position:relative;
  list-style:none;
  padding:0;
  margin:0;
}
.nav>ul>li>ul{
  position:absolute;
  left:0;
  padding:0;
  margin:0;
  list-style:none;
}
.nav>ul>li:hover>ul li a{
  opacity:1;
  height:50px;
   transition:all .3s linear;
  -o-transition:all .3s linear;
  -moz-transition:all .3s linear;
  -webkit-transition:all .3s linear;
}
.nav>ul>li>ul a{
  display:block;
  color:#222;
  width:150px;
  line-height:50px !important;
  font:700 16px 'pt sans',sans-serif;
  background:#eee;
  border-bottom:1px solid #ddd;
  text-align:center;
  padding:0 5px;
  height:0;
  overflow:hidden;
  opacity:0;
  transition:all .3s linear .2s;
  -o-transition:all .3s linear .2s;
  -moz-transition:all .3s linear .2s;
  -webkit-transition:all .3s linear .2s;
}
.nav>ul>li>ul a:hover{
  display:block;
  color:#222;
  width:150px;
  line-height:50px !important;
  font:700 16px 'pt sans',sans-serif;
  background:#A8D9FF;
  border-bottom:1px solid #ddd;
  text-align:center;
  padding:0 5px;
  height:0;
  overflow:hidden;
  opacity:0;
  transition:all .3s linear .2s;
  -o-transition:all .3s linear .2s;
  -moz-transition:all .3s linear .2s;
  -webkit-transition:all .3s linear .2s;
}
.nav>ul>li{
  float:left;
  position:relative;
}
.nav>ul>li>a{
  padding:0 20px;
  color:#fff;
  display:block;
  line-height:70px !important;
  font:400 15px 'PT Sans', sans-serif;
  text-decoration:none;
}

.lamp span{
  display:block;
  height:4px;
  background:#ee6666;
  position: relative;
}
.lamp span:after {
  bottom: 100%;
  left: 50%;
  border: solid transparent;
  content: " ";
  height: 0;
  width: 0;
  position: absolute;
  pointer-events: none;
  border-color: rgba(238, 102, 102, 0);
  border-bottom-color: #ee6666;
  border-width: 4px;
  margin-left: -4px;
}
.lamp{
  position:absolute !important;
  height:4px;
  top:66px;
  background:#333;
  transition:all .3s linear;
  -o-transition:all .3s linear;
  -moz-transition:all .3s linear;
  -webkit-transition:all .3s linear;
}
.selected.active>a,.active>a{
  transition:all .3s linear;
  -o-transition:all .3s linear;
  -moz-transition:all .3s linear;
  -webkit-transition:all .3s linear;
  color:#fff;
}
.credit{
  text-align:center;
  margin:20px 0;
}
.blog-link{
  color:#fff;
  text-decoration:none;
  background:#eee;
  background-size:40px;
  line-height:50px;
  display:inline-block;
  padding:0 10px;
  border-radius:px;
  border-bottom:3px solid #ddd;
  color:#333;
  font-family:'open sans',sans-serif;
  margin:10px;
}
.dgithub{
  color:#fff;
  text-decoration:none;
  background-size:40px;
  line-height:50px;
  display:inline-block;
  padding:0 10px 0 50px;
  background-position:5px;
  border-radius:4px;
  border-bottom:3px solid #ddd;
  color:#333;
  font-family:'open sans',sans-serif;
  margin:10px;
}

#draw-border {
  display: flex;
  align-items: center;
  justify-content: center;
}

view_item {
  border: 1px solid;
  background: none;
  width: 300px;
  text-transform: uppercase;
  text-align:left;
  color: #4361ee;
  font-weight: bold;
  position: relative;
  outline: none;
  padding: 10px 10px;
  box-sizing: border-box;
  border-radius: 8px;
  cursor: pointer;
  value: "";
}
view_item::before, view_item::after {
  box-sizing: inherit;
  position: absolute;
  content: '';
  border: 2px solid transparent;
  width: 0;
  height: 0;
  border-radius: 6px;
}
view_item::after {
  bottom: 0;
  right: 0;
}
view_item::before {
  top: 0;
  left: 0;
}
view_item:hover::before, view_item:hover::after {
  width: 100%;
  height: 100%;
}
view_item:hover::before {
  border-top-color: #4361ee;
  border-right-color: #4361ee;
  transition: width 0s ease-out, height 0s ease-out 0s;
}
view_item:hover::after {
  border-bottom-color: #4361ee;
  border-left-color: #4361ee;
  transition: border-color 0s ease-out 0s, width 0s ease-out 0s, height 0s ease-out 0s;
}

body { background: #f6f6f6;}

.btn {
  width: 120px;
  height: 40px;
  display: inline-block;
  //padding: 2px;
  border-radius: 10px;
  vertical-align: middle;
  background: #0000cd;
  //background: linear-gradient(268deg,#e3164e,#7f1ba7,#841c39,#e993e7,#d27228);
  background-size: 1000% 1000%;
  -webkit-animation: gradient 10s ease infinite;
  -moz-animation: gradient 10s ease infinite;
  -o-animation: Agradient 10s ease infinite;
  animation: gradient 10s ease infinite;
}
.btn input {
  font: 300 14px/14px 'Source Sans Pro',sans-serif;
  letter-spacing: 1px;
  display: block;
  position: relative;
  width: 100%;
  height: 100%;
  text-transform: uppercase;
  background: #0000cd;
  border: none;
  outline: none;
  border-radius: 10px;
  color: #f6f6f6;
  cursor: pointer;
  transition: all 0.3s cubic-bezier(0.645,0.045,0.355,1)
}
.btn:hover input {
  background: transparent;
  color: #f6f6f6;
  letter-spacing: 1px;
  outline: 1px;
  background: #0000e7;
}
 
.btn-toggle-mx {
  -webkit-transform: rotateY(0deg);
  transform: rotateY(0deg);
  -webkit-transition: 0.8s all;
  -o-transition: 0.8s all;
  transition: 0.8s all
}
.btn-toggle-mx.transmx {
  -webkit-transform: rotateY(180deg);
  transform: rotateY(180deg);
}

.progress {
  height:20px;
  background:#ebebeb;
  border-left:1px solid transparent;
  border-right:1px solid transparent;
  border-radius:10px;
}
.progress > span {
  position:relative;
  float:left;
  margin:0 -1px;
  min-width:30px;
  height:18px;
  line-height:16px;
  text-align:right;
  background:#cccccc;
  border:1px solid;
  border-color:#bfbfbf #b3b3b3 #9e9e9e;
  border-radius:10px;
  background-image:-webkit-linear-gradient(top,#f0f0f0 0%,#dbdbdb 70%,#cccccc 100%);
  background-image:-moz-linear-gradient(top,#f0f0f0 0%,#dbdbdb 70%,#cccccc 100%);
  background-image:-o-linear-gradient(top,#f0f0f0 0%,#dbdbdb 70%,#cccccc 100%);
  background-image:linear-gradient(to bottom,#f0f0f0 0%,#dbdbdb 70%,#cccccc 100%);
  -webkit-box-shadow:inset 0 1px rgba(255,255,255,0.3),0 1px 2px rgba(0,0,0,0.2);
  box-shadow:inset 0 1px rgba(255,255,255,0.3),0 1px 2px rgba(0,0,0,0.2);
}
.progress > span > span {
  padding:0 8px;
  font-size:9px;
  font-weight:bold;
  color:#404040;
  color:rgba(0,0,0,0.7);
  text-shadow:0 1px rgba(255,255,255,0.4);
}
.progress > span:before {
  content:'';
  position:absolute;
  top:0;
  bottom:0;
  left:0;
  right:0;
  z-index:1;
  height:18px;
  border-radius:10px;
}
.progress .green {
  background:#85c440;
  border-color:#78b337 #6ba031 #568128;
  background-image:-webkit-linear-gradient(top,#b7dc8e 0%,#99ce5f 70%,#85c440 100%);
  background-image:-moz-linear-gradient(top,#b7dc8e 0%,#99ce5f 70%,#85c440 100%);
  background-image:-o-linear-gradient(top,#b7dc8e 0%,#99ce5f 70%,#85c440 100%);
  background-image:linear-gradient(to bottom,#b7dc8e 0%,#99ce5f 70%,#85c440 100%);
}
.progress .blue {
  background:#5aaadb;
  border-color:#459fd6 #3094d2 #277db2;
  background-image:-webkit-linear-gradient(top,#aed5ed 0%,#7bbbe2 70%,#5aaadb 100%);
  background-image:-moz-linear-gradient(top,#aed5ed 0%,#7bbbe2 70%,#5aaadb 100%);
  background-image:-o-linear-gradient(top,#aed5ed 0%,#7bbbe2 70%,#5aaadb 100%);
  background-image:linear-gradient(to bottom,#aed5ed 0%,#7bbbe2 70%,#5aaadb 100%);
}

#popupmenu_project{
  border:1px solid #ddd;
  background: #eee;
  position: absolute;
  width: 200px;
  height: 140px;
  display: none;
  z-index:8;
}
.popupmenu_project tr:hover{background:#A8D9FF;}

#popupmenu_dataset{
  border:1px solid #ddd;
  background: #eee;
  position: absolute;
  width: 200px;
  height: 50px;
  display: none;
  z-index:8;
}
.popupmenu_dataset tr:hover{background:#A8D9FF;}

#popupmenu_task{
  border:1px solid #ddd;
  background: #eee;
  position: absolute;
  width: 200px;
  height: 50px;
  display: none;
  z-index:8;
}
.popupmenu_task tr:hover{background:#A8D9FF;}

#popupmenu_model{
  border:1px solid #ddd;
  background: #eee;
  position: absolute;
  width: 200px;
  height: 50px;
  display: none;
  z-index:8;
}
.popupmenu_model tr:hover{background:#A8D9FF;}

.scroll-content{
  height: 220px;
}

.table-parms-head{padding-right:17px;background-color:#999;color:#000;}
.table-parms-head table,.table-body table{width:100%;}
.table-parms-body{width:100%; height:210px;overflow-y:scroll;}
.table-parms-body table tr:nth-child(2n+1){background-color:#f2f2f2;}

.table-dataset-labels{width:100%; height:210px; border:1px solid #D6D6D6; overflow-y:scroll; padding:0px 0px;}
.table-dataset-labels table tr:nth-child(2n){background-color:#f2f2f2; padding:0px 0px;}
.table-dataset-labels table td{border:solid #f2f2f2; border-width:0px 1px 1px 0px; padding:0px 0px;}

.table-dataset-imgs{width:100%; height:210px; border:1px solid #D6D6D6; overflow-y:scroll;}

arrow {
  border: solid blue;
  border-width: 0 6px 6px 0;
  display: inline-block;
  padding: 10px;
}
.right {
  transform: rotate(-45deg);
  -webkit-transform: rotate(-45deg);
}
.left {
  transform: rotate(135deg);
  -webkit-transform: rotate(135deg);
}

a:link{
  color:#000000;
  text-decoration:none;}
a:visited{
  color:#000000;
  text-decoration:none;}
a:hover{
  color:#0433FF;
  text-decoration:none;}
a:active{
  color:#000000;
  text-decoration:none;}
</style>

<script type="text/javascript">
//server url address
var str_srv_url = "http://0.0.0.0:8080";

//数据集选择列表，用于创建项目时下拉选择
var g_dataset_list = {};

//创建任务时任务参数dic
var g_train_task_parms = {};

//保存刷新项目任务时需要使用的项目id及type
var g_view_project_task_id = "";
var g_view_project_task_type = "classification";
var g_view_project_task_name = "新建项目";

//用于刷新任务定时器句柄
var g_instance_refresh_clock;
//用于刷新下载进度定时器句柄
var g_instance_download_demo_clock;

//浏览数据集变量
var g_dataset_files = {};
var g_dataset_train_files = {};
var g_dataset_evaluate_files = {};
var g_dataset_test_files = {};
//记录当前页
var g_current_dataset_page = 1;
//每页显示几张图片
var g_const_imgs_per_page = 3;
//当前标签
var g_current_dataset_lable_name = "";
//是否显示标注
var g_b_show_img_labels = false;
//显示数据集范围(默认全量数据)
var g_b_show_dataset_type = "all";

//数据集状态
var DatasetStatus = {
    XEMPTY:0, //空数据集
    XCHECKING:1, //正在验证数据集
    XCHECKFAIL:2, //数据集验证失败 
    XCOPYING:3, //正在导入数据集
    XCOPYDONE:4, //数据集导入成功
    XCOPYFAIL:5, //数据集导入失败 
    XSPLITED:6  //数据集已经切分  
};

//任务状态
var TaskStatus = {
    XUNINIT:0, //任务还未初始化
    XINIT:1, //任务初始化
    XDOWNLOADING:2, //正在下载预训练模型 
    XTRAINING:3, //任务正在运行中，该状态下任务不能被删除
    XTRAINDONE:4, //任务完成运行
    XEVALUATED:5, //任务评估完成 
    XEXPORTING:6,  //任务正在导出inference模型
    XEXPORTED:7, //任务已经导出模型
    XTRAINEXIT:8, //任务运行中止
    XDOWNLOADFAIL:9, //任务下载失败
    XTRAINFAIL:10, //任务运行失败
    XEVALUATING:11,  //任务评估中
    XEVALUATEFAIL:12, //任务评估失败
    XEXPORTFAIL:13, //任务导出模型失败
    XPRUNEING:14, //裁剪分析任务运行中
    XPRUNETRAIN:15  //裁剪训练任务运行中
};

//下载状态
var DownloadStatus = {
    XDDOWNLOADING:0, //下载中
    XDDOWNLOADFAIL:1, //下载失败
    XDDOWNLOADDONE:2,//下载完成
    XDDECOMPRESSED:3//解压完成
};

//预测状态
var PredictStatus = {
    XPRESTART:0, //预测开始
    XPREDONE:1,//预测完成
    XPREFAIL:2 //预测失败
};

//参数范围
var Model_List = {
    "classification":["MobileNetV2", "ResNet18", "ResNet34", "ResNet50", "ResNet101",
                      "ResNet50_vd", "ResNet101_vd", "ResNet50_vd_ssld", "ResNet101_vd_ssld",
                      "DarkNet53", "MobileNetV1", "MobileNetV3_small", "MobileNetV3_large",
                      "MobileNetV3_small_ssld", "MobileNetV3_large_ssld", "Xception41",
                      "Xception65", "DenseNet121", "DenseNet161", "DenseNet201","ShuffleNetV2"],
     "detection":["YOLOv3", "FasterRCNN", "PPYOLO"],
     "segmentation":["DeepLabv3p", "U-Net", "HRNet_W18", "FastSCNN"],
     "instance_segmentation":["MaskRCNN"]
}

var Backbone_List = {
    "YOLOv3": ["DarkNet53", "ResNet34", "MobileNetV1", "MobileNetV3_large"],
    "PPYOLO": ["ResNet50_vd_ssld"],
    "FasterRCNN": ["ResNet18", "ResNet50", "ResNet50_vd", "ResNet101", "ResNet101_vd", "HRNet_W18"],
    "DeepLabv3p": ["Xception65", "Xception41", "MobileNetV3_large_x1_0_ssld", "MobileNetV2_x0.25",
                   "MobileNetV2_x0.5", "MobileNetV2_x1.0", "MobileNetV2_x1.5","MobileNetV2_x2.0"],
    "MaskRCNN": ["ResNet18", "ResNet50", "ResNet50_vd", "ResNet101", "ResNet101_vd", "HRNet_W18"]
}

var Project_Type_Name_Enum = {
    "classification":"图像分类",
    "detection":"目标检测",
    "segmentation":"语义分割",
    "instance_segmentation":"实例分割"
}

var Nav_Bar_Type_Enum = {
    "datasets":"全部数据集",
    "projects":"全部项目",
    "tasks":"全部任务",
    "models":"全部模型",
    "project_tasks":"项目任务"
}

//显示服务器配置窗口
function show_server_info(input_data)
{
    var srv_url_text = document.getElementById('server_url_text');
    srv_url_text.value = str_srv_url;
        
    var input_crt_prj_win = document.getElementById('input_win_cfg_server');
    var input_crt_prj_win_over = document.getElementById('input_win_cfg_server_over');
    input_crt_prj_win.style.display = "block";
    input_crt_prj_win_over.style.display = "block";
}

//隐藏服务器配置窗口
function hide_server_info(input_data)
{
    var on_win_user = document.getElementById('input_win_cfg_server');
    var over_win_user = document.getElementById('input_win_cfg_server_over');
    on_win_user.style.display = "none";
    over_win_user.style.display = "none";
}

//创建项目弹出窗口
function show_create_project_win_modal(obj)
{
    var prj_name_text = document.getElementById('project_name_text');
    project_name_text.value='新建项目';
    
    //加载项目对应的数据集列表
    str_project_type = "classification";
    var obj_sel_create_project_type = document.getElementById('project_type_text');
    obj_sel_create_project_type.value=str_project_type;
    
    //加载数据集信息及默认参数
    var obj_sel_create_project_dataset_id = document.getElementById('create_project_dataset_id_text');
    obj_sel_create_project_dataset_id.options.length = 0
    obj_sel_create_project_dataset_id.options[0] = new Option("请选择项目对应数据集", 0);
    
    var http_request = new XMLHttpRequest();
    http_request.open("GET", str_srv_url + "/dataset", false);
    http_request.send(null);
    str_json_datasets = http_request.responseText;
    
    //取出对应类型的数据集
    var str_json = eval('(' + str_json_datasets + ')');
    var obj_datasets = str_json["datasets"];
    g_dataset_list = obj_datasets;
    for(var p in obj_datasets)
    {
        str_id = obj_datasets[p].id;
        str_attr = obj_datasets[p].attr;
        str_name = str_attr["name"];
        str_desc = str_attr["desc"];
        str_type = str_attr["type"];
        //str_crttime = str_attr["create_time"]
        str_status = str_attr["dataset_status"]
        if(str_status == DatasetStatus.XSPLITED && str_type == str_project_type)
        {
            obj_sel_create_project_dataset_id.options[obj_sel_create_project_dataset_id.options.length] = new Option(str_name, str_id);
        }
    }   
    
    var input_crt_prj_win = document.getElementById('input_win_create_project');
    var input_crt_prj_win_over = document.getElementById('input_win_create_project_over');
    input_crt_prj_win.style.display = "block";
    input_crt_prj_win_over.style.display = "block";
}

//隐藏创建项目弹出窗口
function hide_create_prj_win_modal(obj)
{
    var on_win_create_prj = document.getElementById('input_win_create_project');
    var over_win_create_prj = document.getElementById('input_win_create_project_over');
    on_win_create_prj.style.display = "none";
    over_win_create_prj.style.display = "none";
}

//显示创建数据集弹出窗口
function show_create_dataset_win_modal(obj)
{
    var dataset_name_text = document.getElementById('dataset_name_text');
    dataset_name_text.value='新建数据集';
    
    var input_crt_dataset_win = document.getElementById('input_win_create_dataset');
    var input_crt_dataset_win_over = document.getElementById('input_win_create_dataset_over');
    input_crt_dataset_win.style.display = "block";
    input_crt_dataset_win_over.style.display = "block";
}

//隐藏创建数据集弹出窗口
function hide_create_dataset_win_modal(obj)
{
    var on_win_create_dataset = document.getElementById('input_win_create_dataset');
    var over_win_create_dataset = document.getElementById('input_win_create_dataset_over');
    on_win_create_dataset.style.display = "none";
    over_win_create_dataset.style.display = "none";
}

//显示导入数据集弹出窗口
function show_import_dataset_win_modal(obj)
{
    var on_win_import_dataset = document.getElementById('input_win_import_dataset');
    var over_win_import_dataset = document.getElementById('input_win_import_dataset_over');
    var input_import_dataset_id = document.getElementById('import_dataset_id');
    
    on_win_import_dataset.style.display = "block";
    over_win_import_dataset.style.display = "block";
    
    input_import_dataset_id.value = obj.id;
}

//隐藏导入数据集弹出窗口
function hide_import_dataset_win_modal(obj)
{
    var on_win_import_dataset = document.getElementById('input_win_import_dataset');
    var over_win_import_dataset = document.getElementById('input_win_import_dataset_over');
    var input_import_dataset_id = document.getElementById('import_dataset_id');
    
    on_win_import_dataset.style.display = "none";
    over_win_import_dataset.style.display = "none";
    input_import_dataset_id.value = "";
}

//重新切分数据集
function re_split_dataset(obj)
{
    var on_win_split_dataset = document.getElementById('input_win_split_dataset');
    var over_win_split_dataset = document.getElementById('input_win_split_dataset_over');
    
    //获取需要切分的数据集ID
    document.getElementById('split_dataset_id').value = document.getElementById('browse_dataset_id').value;
    
    on_win_split_dataset.style.display = "block";
    over_win_split_dataset.style.display = "block";
}

//切分数据集弹出窗口
function show_split_dataset_win_modal(obj)
{
    var on_win_split_dataset = document.getElementById('input_win_split_dataset');
    var over_win_split_dataset = document.getElementById('input_win_split_dataset_over');
    var input_split_dataset_id = document.getElementById('split_dataset_id');
    
    on_win_split_dataset.style.display = "block";
    over_win_split_dataset.style.display = "block";
    
    input_split_dataset_id.value = obj.id;
}

//隐藏切分数据集弹出窗口
function hide_split_dataset_win_modal(obj)
{
    var on_win_split_dataset = document.getElementById('input_win_split_dataset');
    var over_win_split_dataset = document.getElementById('input_win_split_dataset_over');
    var input_split_dataset_id = document.getElementById('split_dataset_id');
    
    on_win_split_dataset.style.display = "none";
    over_win_split_dataset.style.display = "none";
    input_split_dataset_id.value = "";
}

//获取数据集详细信息
function get_dataset_detail_info(str_dataset_id)
{
    var http_request;
    if (window.XMLHttpRequest)
    {
        http_request=new XMLHttpRequest();
        http_request.withCredentials = true;
    }
    else
    {
        http_request=new ActiveXObject("Microsoft.XMLHTTP");
    }
    
    http_request.open("GET",str_srv_url + "/dataset/details?did=" + str_dataset_id, false);
    http_request.send(null);
    
    var str_dataset_detail_info = http_request.responseText;
    return str_dataset_detail_info;
}

//加载图片
function load_labels_imgs(str_lbl_name, int_page = 1)
{
     var lst_img_files = g_dataset_files[str_lbl_name];
     if (g_b_show_dataset_type == "all")
     {
         lst_img_files = g_dataset_files[str_lbl_name];
     }
     else if (g_b_show_dataset_type == "train")
     {
         lst_img_files = g_dataset_train_files[str_lbl_name];
     }
     else if (g_b_show_dataset_type == "evaluate")
     {
         lst_img_files = g_dataset_evaluate_files[str_lbl_name];
     }
     else if (g_b_show_dataset_type == "test")
     {
         lst_img_files = g_dataset_test_files[str_lbl_name];
     }
     
     var str_dataset_id = document.getElementById('browse_dataset_id').value;
     //获取数据集路径
     var str_dataset_path = document.getElementById('view_dataset_path_' + str_dataset_id).value;
     
     var curr_file_idx = g_const_imgs_per_page * (int_page - 1);
     
     var img_count = 0;
     for(var j=curr_file_idx;j<lst_img_files.length;j++)
     {
         var str_img_file_name = lst_img_files[j];
         var str_img_file = str_dataset_path + "/" + str_img_file_name;
         //是否显示标注
         var str_img_file_content = "";
         if(g_b_show_img_labels == true)
         {
             str_img_file_content = get_img_file_from_server(str_img_file, str_dataset_id);
         }
         else
         {
             str_img_file_content = get_img_file_from_server(str_img_file);
         }
         //更新img框内容
         img_count = img_count + 1;
         var obj_img = document.getElementById('dataset_img_' + img_count);
         var idx_file_postfix = str_img_file_name.lastIndexOf(".");
         var str_file_type = "jpeg";
         if(idx_file_postfix >= 0)
         {
             str_file_type = str_img_file_name.substring(idx_file_postfix + 1,str_img_file_name.length);
         }
         
         str_file_type = str_file_type.toLowerCase();
         
         var str_b64_type = "data:image/jpeg;base64,";
         
         if(str_file_type == "jpg" || str_file_type == "jpeg")
             str_b64_type = "data:image/jpeg;base64,";
         else if (str_file_type == "bmp")
             str_b64_type = "data:image/jpeg;base64,";
         else if (str_file_type == "png")
             str_b64_type = "data:image/png;base64,";
         
         obj_img.src = str_b64_type + str_img_file_content;
         obj_img.style.visibility='';
         
         //更新文件名称
         var idx_path_split = str_img_file_name.lastIndexOf("/");
         var str_img_file_shot_name = str_img_file_name;
         if(idx_path_split >= 0)
         {
             str_img_file_shot_name = str_img_file_name.substring(idx_path_split + 1,str_img_file_name.length);
         }
         document.getElementById('dataset_img_' + img_count + "_file_name").innerText = str_img_file_shot_name;
         if(img_count >= g_const_imgs_per_page)
         {
             break;
         }
     }
     
     //清除无需显示的图像框
     if(img_count < g_const_imgs_per_page)
     {
         for(var k=img_count + 1;k<=g_const_imgs_per_page;k++)
         {
             document.getElementById('dataset_img_' + k).src = " ";
             document.getElementById('dataset_img_' + k).style.visibility='hidden';
             document.getElementById('dataset_img_' + k + "_file_name").innerText = "";
         }
     }
}

//从服务端请求文件内容
function get_img_file_from_server(str_file_name, str_dataset_id = "")
{
    var http_request = new XMLHttpRequest();
    if(str_dataset_id == "")
    {
        http_request.open("GET", str_srv_url + "/file?path=" + str_file_name, false);
    }
    else
    {
        http_request.open("GET", str_srv_url + "/file?path=" + str_file_name + "&did=" + str_dataset_id, false);
    }
    http_request.send(null);
    
    var obj_json = eval('(' + http_request.responseText + ')'); 
    var str_data = obj_json["img_data"];
    return str_data;
}

//从服务端获取日志文件
function get_log_file_from_server(str_log_file_name)
{
    var http_request = new XMLHttpRequest();
    http_request.open("GET", str_srv_url + "/file?path=" + str_log_file_name, false);
    http_request.send(null);
    
    return http_request.responseText;
}

//从服务器获取一张图片数据，用于数据集图片预览向前及向后
var g_curr_img_file_idx = 0;
var g_dbl_clk_img_frame_id = "dataset_img_1";

function get_one_img_file(str_dir = "next")
{
    var lst_img_files = g_dataset_files[g_current_dataset_lable_name];
     
    if (g_b_show_dataset_type == "all")
    {
        lst_img_files = g_dataset_files[g_current_dataset_lable_name];
    }
    else if (g_b_show_dataset_type == "train")
    {
        lst_img_files = g_dataset_train_files[g_current_dataset_lable_name];
    }
    else if (g_b_show_dataset_type == "evaluate")
    {
        lst_img_files = g_dataset_evaluate_files[g_current_dataset_lable_name];
    }
    else if (g_b_show_dataset_type == "test")
    {
        lst_img_files = g_dataset_test_files[g_current_dataset_lable_name];
    }
     
    //数据集ID
    var str_dataset_id = document.getElementById('browse_dataset_id').value;
    //获取数据集路径
    var str_dataset_path = document.getElementById('view_dataset_path_' + str_dataset_id).value;
    
    var idx_img_frame_postfix = g_dbl_clk_img_frame_id.lastIndexOf("_");
    var idx_img_frame = 0;
    if(idx_img_frame_postfix >= 0)
    {
        idx_img_frame = parseInt(g_dbl_clk_img_frame_id.substring(idx_img_frame_postfix + 1,g_dbl_clk_img_frame_id.length)) - 1;
    }
    
    if (g_curr_img_file_idx == 0)
    {
        g_curr_img_file_idx = g_const_imgs_per_page * (g_current_dataset_page - 1) + idx_img_frame;
    }

    if(str_dir == "next")
    {
        g_curr_img_file_idx++;
        document.getElementById('arrow_pre_img').style.borderColor='blue';
    }
    else
    {
        g_curr_img_file_idx--;
        document.getElementById('arrow_next_img').style.borderColor='blue';
    }

     
    if(g_curr_img_file_idx <= 0)
    {
        g_curr_img_file_idx = 0;
        document.getElementById('arrow_pre_img').style.borderColor='gray';
    }
    if(g_curr_img_file_idx >= lst_img_files.length)
    {
        g_curr_img_file_idx = lst_img_files.length;
        document.getElementById('arrow_next_img').style.borderColor='gray';
    }
     
    var str_img_file_name = lst_img_files[g_curr_img_file_idx];
    var str_img_file = str_dataset_path + "/" + str_img_file_name;
    //是否显示标注
    var str_img_file_content = "";
    if(g_b_show_img_labels == true)
    {
        str_img_file_content = get_img_file_from_server(str_img_file, str_dataset_id);
    }
    else
    {
        str_img_file_content = get_img_file_from_server(str_img_file);
    }
    //更新img框内容
    var obj_img = document.getElementById('dataset_browse_img');
    var idx_file_postfix = str_img_file_name.lastIndexOf(".");
    var str_file_type = "jpeg";
    if(idx_file_postfix >= 0)
    {
        str_file_type = str_img_file_name.substring(idx_file_postfix + 1,str_img_file_name.length);
    }
         
    str_file_type = str_file_type.toLowerCase();
         
    var str_b64_type = "data:image/jpeg;base64,";
         
    if(str_file_type == "jpg" || str_file_type == "jpeg")
        str_b64_type = "data:image/jpeg;base64,";
    else if (str_file_type == "bmp")
        str_b64_type = "data:image/jpeg;base64,";
    else if (str_file_type == "png")
        str_b64_type = "data:image/png;base64,";
         
    obj_img.src = str_b64_type + str_img_file_content;
}

//刷新翻页按纽
function refresh_dataset_page_buttons()
{
    var int_file_count = g_dataset_files[g_current_dataset_lable_name].length;
    if (g_b_show_dataset_type == "all")
    {
        int_file_count = g_dataset_files[g_current_dataset_lable_name].length;
    }
    else if (g_b_show_dataset_type == "train")
    {
        int_file_count = g_dataset_train_files[g_current_dataset_lable_name].length;
    }
    else if (g_b_show_dataset_type == "evaluate")
    {
        int_file_count = g_dataset_evaluate_files[g_current_dataset_lable_name].length;
    }
    else if (g_b_show_dataset_type == "test")
    {
        int_file_count = g_dataset_test_files[g_current_dataset_lable_name].length;
    }
     
    var max_page_num = Math.ceil(int_file_count / g_const_imgs_per_page);
    
    document.getElementById('dataset_page_info').innerText = "第" + g_current_dataset_page + "页/共" + max_page_num + "页";
}

//加载数据标签信息
function add_labels_to_table(str_lbl_list,dic_file_lst,dic_train_lst,dic_evaluate_lst,dic_test_lst)
{
    g_dataset_files = dic_file_lst;
    g_dataset_train_files = dic_train_lst;
    g_dataset_evaluate_files = dic_evaluate_lst;
    g_dataset_test_files = dic_test_lst;
    
    var rows = table_dataset_labels.rows.length;
    for (i=rows-1;i>=1;i--)
    {
        table_dataset_labels.deleteRow(i);
    }

    for(var j=0;j<str_lbl_list.length;j++)
    {
        var str_lbl_name = str_lbl_list[j];
        var lst_files = dic_file_lst[str_lbl_name];
        var lst_train_files = dic_train_lst[str_lbl_name];
        var lst_evaluate_files = dic_evaluate_lst[str_lbl_name];
        var lst_test_files = dic_test_lst[str_lbl_name];
        
        var rows = table_dataset_labels.rows.length;
        var newTr = table_dataset_labels.insertRow(rows);
        newTr.id = str_lbl_name;
        newTr.onclick=function()
        {
            g_current_dataset_page = 1;
            g_current_dataset_lable_name = this.id;
            
            var tbl_trs = table_dataset_labels.getElementsByTagName("tr");
            for(var k = 1; k < tbl_trs.length; k++)
            {
                var bg_color = "#f2f2f2";
                if(k % 2 == 0)
                {
                    bg_color = "#ffffff";
                }
                else
                {
                    bg_color = "#f2f2f2";
                }
                if(k == this.rowIndex)
                {
                    bg_color = "#76D6FF";
                }
                tbl_trs[k].style.backgroundColor = bg_color;
            }
            
            load_labels_imgs(this.id, g_current_dataset_page);
            refresh_dataset_page_buttons();
        }
        
        newTr.style.cursor="pointer";
        if(j == 0)
        {
            newTr.style.backgroundColor = "#76D6FF";
        }
    
        var newTd0=newTr.insertCell();
        newTd0.innerText = str_lbl_name;
        
        var newTd1=newTr.insertCell();
        newTd1.innerText = lst_files.length;
        
        var newTd2=newTr.insertCell();
        newTd2.innerText = lst_train_files.length;
        
       var newTd3=newTr.insertCell();
        newTd3.innerText = lst_evaluate_files.length;
        
        var newTd4=newTr.insertCell();
        newTd4.innerText = lst_test_files.length;
    }
}

//浏览数据集弹出窗口
function show_browse_dataset_win_modal(obj)
{
    var on_win_browse_dataset = document.getElementById('win_browse_dataset');
    var over_win_browse_dataset = document.getElementById('win_browse_dataset_over');
    document.getElementById('browse_dataset_id').value = obj.id;
    
    var str_dataset_details = get_dataset_detail_info(obj.id);

    var obj_json_dataset_details = eval('(' + str_dataset_details + ')'); 
    var lst_labels = obj_json_dataset_details["details"]["labels"];
    var lst_files = obj_json_dataset_details["details"]["label_info"];
    
    //训练集及测试集
    var lst_train_files = obj_json_dataset_details["details"]["class_train_file_list"];
    var lst_evaluate_files = obj_json_dataset_details["details"]["class_val_file_list"];
    var lst_test_files = obj_json_dataset_details["details"]["class_test_file_list"];
    
    //数据集详情
    document.getElementById('browse_dataset_name_text').value = document.getElementById('view_dataset_name_' + obj.id).value;
    document.getElementById('browse_dataset_type_text').value = document.getElementById('view_dataset_type_' + obj.id).value;
    document.getElementById('browse_dataset_desc_text').value = document.getElementById('view_dataset_desc_' + obj.id).value;
    
    //分类不需要显示标注
    if(document.getElementById('browse_dataset_type_text').value == "图像分类")
    {
        document.getElementById('dataset_chk_show_label').style.visibility = "hidden";
        document.getElementById('dataset_chk_show_label_txt').style.visibility = "hidden";
    }
    else
    {
        document.getElementById('dataset_chk_show_label').style.visibility = "";
        document.getElementById('dataset_chk_show_label_txt').style.visibility = "";
    }
    
    //默认不显示标注
    g_b_show_img_labels = false;
    document.getElementById('dataset_chk_show_label').checked = false;
    
    //默认显示全量数据
    g_b_show_dataset_type = "all";
    document.getElementById('sel_dataset_view_type')[0].selected = true;
    
    //刷新标签
    add_labels_to_table(lst_labels, lst_files, lst_train_files, lst_evaluate_files, lst_test_files);
    
    //加载预览图片
    g_current_dataset_lable_name = lst_labels[0];
    load_labels_imgs(lst_labels[0],g_current_dataset_page);
    
    //刷新翻页按纽
    refresh_dataset_page_buttons();
    
    on_win_browse_dataset.style.display = "block";
    over_win_browse_dataset.style.display = "block";
}

//关闭浏览数据集
function hide_browse_dataset_win_modal(obj)
{
    //当前页重置
    g_current_dataset_page = 1;
    g_b_show_dataset_type = "all";
    
    var on_win_browse_dataset = document.getElementById('win_browse_dataset');
    var over_win_browse_dataset = document.getElementById('win_browse_dataset_over');
    document.getElementById('browse_dataset_id').value = "";
    
    on_win_browse_dataset.style.display = "none";
    over_win_browse_dataset.style.display = "none";
}

//双击放大图像
function zoom_image(obj)
{
    g_curr_img_file_idx = 0;
    g_dbl_clk_img_frame_id = obj.id;
    
    if(g_dbl_clk_img_frame_id.indexOf("dataset") >= 0)
    {

        document.getElementById('arrow_pre_img').style.borderColor='blue';
        document.getElementById('arrow_next_img').style.borderColor='blue';
    }
    else
    {
        document.getElementById('arrow_pre_img').style.borderColor='gray';
        document.getElementById('arrow_next_img').style.borderColor='gray';
    }
    
    if(obj.src != "")
    {
        document.getElementById('dataset_browse_img').src = obj.src;
        var on_win_browse_img = document.getElementById('win_browse_img');
        var over_win_browse_img = document.getElementById('win_browse_img_over');
    
        on_win_browse_img.style.display = "block";
        over_win_browse_img.style.display = "block";
    }
}

//关闭放大预览图片窗口
function hide_zoom_img(obj)
{
    g_curr_img_file_idx = 0;
    
    var on_win_browse_img = document.getElementById('win_browse_img');
    var over_win_browse_img = document.getElementById('win_browse_img_over');
    
    on_win_browse_img.style.display = "none";
    over_win_browse_img.style.display = "none";
}

//关闭日志查看窗口
function hide_log_win(obj)
{
    var on_win_view_log = document.getElementById('win_view_log');
    var over_win_view_log = document.getElementById('win_view_log_over');
    
    on_win_view_log.style.display = "none";
    on_win_view_log.style.display = "none";
}

//上一页
function dataset_pre_page()
{
    g_current_dataset_page = g_current_dataset_page - 1;
    if(g_current_dataset_page <= 0)
    {
        g_current_dataset_page = 1;
    }
    
    load_labels_imgs(g_current_dataset_lable_name, g_current_dataset_page);
    
    refresh_dataset_page_buttons();
}

//下一页
function dataset_next_page()
{
    g_current_dataset_page = g_current_dataset_page + 1;
    
    //是否大于最大页
    var int_file_max_count = g_dataset_files[g_current_dataset_lable_name].length;
    if (g_b_show_dataset_type == "all")
    {
        int_file_max_count = g_dataset_files[g_current_dataset_lable_name].length;
    }
    else if (g_b_show_dataset_type == "train")
    {
        int_file_max_count = g_dataset_train_files[g_current_dataset_lable_name].length;
    }
    else if (g_b_show_dataset_type == "evaluate")
    {
        int_file_max_count = g_dataset_evaluate_files[g_current_dataset_lable_name].length;
    }
    else if (g_b_show_dataset_type == "test")
    {
        int_file_max_count = g_dataset_test_files[g_current_dataset_lable_name].length;
    }
    
    if(g_current_dataset_page * g_const_imgs_per_page > int_file_max_count + 2)
    {
        g_current_dataset_page = g_current_dataset_page - 1;
    }
    
    load_labels_imgs(g_current_dataset_lable_name, g_current_dataset_page);
    
    refresh_dataset_page_buttons();
}

//显示全量数据或者其他数据
function change_dataset_view_type(obj)
{
    g_b_show_dataset_type = obj.value;
    g_current_dataset_page = 1;
    load_labels_imgs(g_current_dataset_lable_name, g_current_dataset_page);
    
    refresh_dataset_page_buttons();
}

//显示标注
function show_dataset_labels()
{
    g_b_show_img_labels = !g_b_show_img_labels;
    load_labels_imgs(g_current_dataset_lable_name, g_current_dataset_page);
}

//秒转换为日期
function left_second_to_time(int_sec = 0)
{ 
    var time_sec = parseInt(int_sec);
    var time_min = 0;
    var time_hour = 0;
    var time_day = 0;
    if(time_sec > 60)
    { 
        time_min = parseInt(time_sec/60); 
        time_sec = parseInt(time_sec%60); 
        if(time_min > 60)
        { 
            time_hour = parseInt(time_min/60); 
            time_min = parseInt(time_min%60); 
            if(time_hour > 24)
            {
                time_day = parseInt(time_hour/24);
                time_hour = parseInt(time_hour%24);
            }
        }
    }
    
    var result = '';
    if(time_sec > 0)
    {
        result = "" + parseInt(time_sec) + "秒";
    }
    if(time_min > 0)
    { 
        result = "" + parseInt(time_min) + "分" + result;
    } 
    if(time_hour > 0)
    { 
        result = "" + parseInt(time_hour) + "小时" + result;
    } 
    if(time_day > 0)
    { 
        result = "" + parseInt(time_day) + "天" + result;
    }
    return result;
}

//根据任务状态更新任务信息UI
function update_task_detail_info_ui(str_view_task_id, b_get_task_parms = false)
{
    //获取任务信息，刷新任务窗口
    var http_request = new XMLHttpRequest();
    http_request.open("GET", str_srv_url + "/project/task?tid=" + str_view_task_id, false);
    http_request.send(null);
    
    var obj_json = eval('(' + http_request.responseText + ')'); 
    var str_task_msg = obj_json["message"];
    var str_task_status = obj_json["task_status"];
    
    var running_duration = "NA";
    var progress_bar_value = 0;
    var str_view_task_status_text = "任务初始化";
    var str_task_next_button_lable = "关闭"
    var obj_task_next_button = document.getElementById('btn_next_task_info');
    //停止任务按纽
    var obj_stop_task_div = document.getElementById('div_btn_stop_task');
    var b_show_stop_task_btn = false;
    
    if (str_task_status == TaskStatus.XINIT)
    {
        str_view_task_status_text = "任务初始化";
    }    
    else if (str_task_status == TaskStatus.XTRAINFAIL)
    {
        str_view_task_status_text = "任务训练失败";
        
        str_task_next_button_lable = "查看错误日志";
    }
    else if (str_task_status == TaskStatus.XTRAINDONE)
    {
        str_view_task_status_text = "任务训练完成";
        progress_bar_value = 100;
        str_task_msg = "任务训练完成，请进行模型评估或者导出模型";
        
        //取消按纽更新为评估&导出模型
        str_task_next_button_lable = "评估&导出模型";
    }  
    else if (str_task_status == TaskStatus.XTRAINING)
    {
        str_view_task_status_text = "任务训练中";
        b_show_stop_task_btn = true;
        
        //获取任务参数
        if(b_get_task_parms == true)
        {
            var train_parms_http_request = new XMLHttpRequest();
            train_parms_http_request.open("GET", str_srv_url + "/project/task/params?tid=" + str_view_task_id, false);
            train_parms_http_request.send(null);
            var obj_parms_json = eval('(' + train_parms_http_request.responseText + ')');
            g_train_task_parms = obj_parms_json["train"];
        }
        
        //获取训练状态
        var train_http_request = new XMLHttpRequest();
        train_http_request.open("GET", str_srv_url + "/project/task/metrics?tid=" + str_view_task_id + "&type=train", false);
        train_http_request.send(null);
        str_task_msg = train_http_request.responseText;
        try
        {
            var obj_train_msg_json = eval('(' + str_task_msg + ')');
            var dic_train_log_metric = obj_train_msg_json["train_log"]["train_metrics"];
            running_duration = obj_train_msg_json["train_log"]["running_duration"];
            var curr_epoc = dic_train_log_metric["Epoch"];
            var curr_step = dic_train_log_metric["Step"];
            var curr_acc1 = dic_train_log_metric["acc1"];
            var curr_acc5 = dic_train_log_metric["acc5"];
            var curr_loss = dic_train_log_metric["loss"];
            var curr_lr = dic_train_log_metric["lr"];
            var left_time = parseInt(obj_train_msg_json["train_log"]["eta"]);
            
            if(left_time > 0)
                running_duration = "已运行: " + running_duration + "  (估计剩余时间: " + left_second_to_time(left_time) + ")";
        
            //计算进度
            var cur_progress = parseInt((parseInt(curr_epoc)-1)/parseInt(g_train_task_parms["num_epochs"]) * 100);
            if(cur_progress > 100)
                cur_progress = 100;
            
            progress_bar_value = cur_progress;
        }
        catch(err)
        {
            str_view_task_status_text = "任务训练中（启动训练中）";
            progress_bar_value = 0;
            str_task_msg = "任务训练中（启动训练中），请稍等...";
        }
        
        //启动定时器，用于定时刷新任务状态
        if(b_get_task_parms)
        {
            g_instance_refresh_clock = self.setInterval("refresh_task_detail_info_win()",1000);
        }
    }
    else if (str_task_status == TaskStatus.XEXPORTING)
    {
        str_view_task_status_text = "任务训练完成（模型导出中）";
        progress_bar_value = 100;
        str_task_msg = "任务训练完成（模型导出中），可以重新进行模型评估或者导出模型";
        
        //取消按纽更新为评估&导出模型
        str_task_next_button_lable = "评估&导出模型";
    } 
    else if (str_task_status == TaskStatus.XEXPORTED)
    {
        str_view_task_status_text = "任务训练完成（模型已导出）";
        progress_bar_value = 100;
        str_task_msg = "任务训练完成（模型已导出），可以重新进行模型评估或者导出模型";
        
        //取消按纽更新为评估&导出模型
        str_task_next_button_lable = "评估&导出模型";
    }
    else if (str_task_status == TaskStatus.XTRAINEXIT)
    {
        str_view_task_status_text = "任务已中止";
        progress_bar_value = 0;
        str_task_msg = "任务已中止，可以重新启动模型训练";
        
        //取消按纽更新为评估&导出模型
        str_task_next_button_lable = "继续训练";
    }
    
    var obj_view_task_status_text = document.getElementById('task_detail_status_text');
    obj_view_task_status_text.value = str_view_task_status_text;
    
    var obj_view_task_log_text = document.getElementById('task_detail_log_text');
    obj_view_task_log_text.value = str_task_msg;  

    var obj_view_task_running_duration_text = document.getElementById('task_detail_running_duration_text');
    obj_view_task_running_duration_text.value = running_duration;
    
    //进度条
    var obj_view_task_status_progress_value = document.getElementById('task_detail_status_progress_bar_value');
    obj_view_task_status_progress_value.style = "width: " + progress_bar_value + "%;";
    var obj_view_task_status_progress_bar = document.getElementById('task_detail_status_progress_bar');
    obj_view_task_status_progress_value.innerText = progress_bar_value + "%";
    
    //按纽标题
    obj_task_next_button.value = str_task_next_button_lable;
    //停止任务按纽显示
    if(b_show_stop_task_btn == true)
    {
        obj_stop_task_div.style.visibility = "";
    }
    else
    {
        obj_stop_task_div.style.visibility = "hidden";
    }
}

//显示任务运行状态窗口
function show_task_detail_info_win_modal(obj)
{
    var input_task_detail_id = document.getElementById('task_detail_id');
    input_task_detail_id.value = obj.id;
    
    //获取任务信息，刷新任务窗口
    var str_view_task_id = obj.id;
    
    update_task_detail_info_ui(str_view_task_id, true);
    
    var task_detail_info_win = document.getElementById('task_detail_info');
    var task_detail_info_win_over = document.getElementById('task_detail_info_over');  
    task_detail_info_win.style.display = "block";
    task_detail_info_win_over.style.display = "block";
}

//用于定时刷新任务运行状态窗口
function refresh_task_detail_info_win()
{
    var input_task_detail_id = document.getElementById('task_detail_id');
    var str_view_task_id = input_task_detail_id.value;
    
    update_task_detail_info_ui(str_view_task_id, false);
}

//关闭任务运行信息弹出窗口
function hide_task_detail_info_win_modal()
{
    var task_detail_info_win = document.getElementById('task_detail_info');
    var task_detail_info_win_over = document.getElementById('task_detail_info_over');
    var input_task_detail_id = document.getElementById('task_detail_id');
    
    task_detail_info_win.style.display = "none";
    task_detail_info_win_over.style.display = "none";
    input_task_detail_id.value = "";
    
    //关闭定时器
    g_instance_refresh_clock=window.clearInterval(g_instance_refresh_clock);
}

//模型训练结束下一步处理（模型评估&导出）
function task_next_step_process(obj)
{
    var str_btn_label = obj.value;
    if(str_btn_label == "关闭")
    {
        hide_task_detail_info_win_modal();
    }
    else if(str_btn_label == "查看错误日志")
    {
        var str_error_tid = document.getElementById('task_detail_id').value;
        var str_error_task_pid = document.getElementById('view_task_pid_' + str_error_tid).value;
        //日志路径
        var http_request = new XMLHttpRequest();
        http_request.open('GET', str_srv_url + "/workspace", false);
        http_request.send(null);
    
        var obj_json = eval('(' + http_request.responseText + ')');
        var str_server_workspace_path = obj_json["dirname"];
        var str_error_log_path = str_server_workspace_path + "/projects/" + str_error_task_pid + "/" + str_error_tid + "/err.log";
        
        var str_error_info = get_log_file_from_server(str_error_log_path);
        
        //显示错误信息
        document.getElementById('view_log_text').value = str_error_info;
        var on_win_view_log = document.getElementById('win_view_log');
        var over_win_view_log = document.getElementById('win_view_log_over');
    
        on_win_view_log.style.display = "block";
        on_win_view_log.style.display = "block";
    }
    else if(str_btn_label == "评估&导出模型")
    {
        //启动模型评估
        show_evaluate_export_win_modal(obj);
        //隐藏原来窗口
        hide_task_detail_info_win_modal();  
    }
    else if(str_btn_label == "继续训练")
    {
        //重新启动模型训练
        var str_start_tid = "";
        var obj_start_task_id_input = document.getElementById('task_detail_id');
        str_start_tid = obj_start_task_id_input.value;
        
        start_task(str_start_tid);
        
        if (document.getElementById('btn_refresh').value == "刷新项目任务信息")
        {
            load_project_tasks(g_view_project_task_id);
        }
        else
        {
            load_tasks();
        }
        //隐藏原来窗口
        hide_task_detail_info_win_modal();  
    }
}

//打开VDL链接
function open_task_vdl_window()
{
    var input_task_detail_id = document.getElementById('task_detail_id');
    var str_view_task_id = input_task_detail_id.value;
    
    var http_request;
    if (window.XMLHttpRequest)
    {
        http_request=new XMLHttpRequest();
    }
    else
    {
        http_request=new ActiveXObject("Microsoft.XMLHTTP");
    } 
    http_request.onreadystatechange=function()
    {
        if (http_request.readyState==4)
        {
            if (http_request.status==200)
            {
                //获取URL并打开
                str_json = http_request.responseText;
                var obj_json = eval('(' + str_json + ')');
                var str_vdl_url = obj_json["url"];
                //alert(str_vdl_url);
                window.open("http://" + str_vdl_url);
            }
            else
            {
                alert("打开失败，请检查服务器配置\n" + http_request.responseText);
            }
        }
    }

    http_request.open("GET", str_srv_url + "/project/task/vdl?tid=" + str_view_task_id, true);
    http_request.send(null);  
}

//关闭评估&导出模型弹出窗口
function hide_evaluate_export_win_modal(obj)
{
    var obj_evaluate_export_task_project_id = document.getElementById('evaluate_export_task_project_id');
    obj_evaluate_export_task_project_id.value = "";
    
    document.getElementById('btn_evaluate_task_info').value = "启动评估";
    
    var on_win_evaluate_export_model = document.getElementById('input_win_evaluate_export_model');
    var over_win_evaluate_export_model = document.getElementById('input_win_evaluate_export_model_over');
    on_win_evaluate_export_model.style.display = "none";
    over_win_evaluate_export_model.style.display = "none";
}

//显示评估&导出模型弹出窗口
function show_evaluate_export_win_modal(obj)
{
    var obj_detail_task_id = document.getElementById('task_detail_id');
    var obj_export_task_id = document.getElementById('evaluate_export_task_id');
    obj_export_task_id.value = obj_detail_task_id.value;
    
    if(null == obj_export_task_id.value || 'undefined' == typeof(obj_export_task_id.value) || '' == obj_export_task_id.value)
    {
        obj_export_task_id.value = obj.id;
    }
    
    //初始化路径(workspace/projects/TXXX/export_model)
    var http_request = new XMLHttpRequest();
    http_request.open('GET', str_srv_url + "/workspace", false);
    http_request.send(null);
    
    var obj_json = eval('(' + http_request.responseText + ')');
    var str_init_model_save_path = obj_json["dirname"];
    
    var str_obj_task_prj_key = "view_task_pid_" + obj_export_task_id.value;
    var obj_project_id = document.getElementById(str_obj_task_prj_key);
    var str_project_id = obj_project_id.value;
    
    var obj_evaluate_export_task_project_id = document.getElementById('evaluate_export_task_project_id');
    obj_evaluate_export_task_project_id.value = str_project_id;
    
    var obj_model_save_path = document.getElementById('export_model_path_text');
    obj_model_save_path.value = str_init_model_save_path + "/projects/" + str_project_id + "/" + obj_export_task_id.value + "/export_model";
    
    var on_win_evaluate_export_model = document.getElementById('input_win_evaluate_export_model');
    var over_win_evaluate_export_model = document.getElementById('input_win_evaluate_export_model_over');
    on_win_evaluate_export_model.style.display = "block";
    over_win_evaluate_export_model.style.display = "block";
}

//评估任务
function evaluate_task(obj)
{
    if (document.getElementById('btn_evaluate_task_info').value == "评估中...")
    {
        alert("评估进行中，请稍候...");
        return;
    }
    
    var obj_evaluate_task_id = document.getElementById('evaluate_export_task_id');
    var str_evaluate_task_id = obj_evaluate_task_id.value;

    //启动评估
    var http_request;
    if (window.XMLHttpRequest)
    {
        http_request=new XMLHttpRequest();
    }
    else
    {
        http_request=new ActiveXObject("Microsoft.XMLHTTP");
    } 
    http_request.onreadystatechange=function()
    {
        if (http_request.readyState==4)
        {
            if (http_request.status==200)
            {
                //查询评估报告
                document.getElementById('btn_evaluate_task_info').value = "评估中...";
                g_evaluate_task_wait_times = 0;
                setTimeout(function(){get_evaluate_result(str_evaluate_task_id);}, 1000);
            }
            else
            {
                alert("启动评估失败，请检查服务器配置\n" + http_request.responseText);
            }
        }
    }

    var data = {"tid":str_evaluate_task_id,"epoch":null,"topk":5,'score_thresh':null, 'overlap_thresh':null};
    http_request.open("POST", str_srv_url + "/project/task/evaluate", true);
    http_request.setRequestHeader("Content-type","application/json");
    http_request.send(JSON.stringify(data));
}

//获取任务评估状态和结果
var g_evaluate_task_wait_times = 0;

function get_evaluate_result(str_task_id)
{
    g_evaluate_task_wait_times = g_evaluate_task_wait_times + 1;
    
    var http_request;
    if (window.XMLHttpRequest)
    {
        http_request=new XMLHttpRequest();
    }
    else
    {
        http_request=new ActiveXObject("Microsoft.XMLHTTP");
    }
    
    http_request.open("GET", str_srv_url + "/project/task/evaluate?tid=" + str_task_id, false);
    http_request.send(null);
    
    var obj_json = eval('(' + http_request.responseText + ')');
    var str_evaluate_status = parseInt(obj_json["evaluate_status"]);
    
    if(str_evaluate_status == TaskStatus.XEVALUATED)
    {
        document.getElementById('btn_evaluate_task_info').value = "启动评估";
        alert("评估成功，详细信息:\n" + http_request.responseText);
    }
    else if(str_evaluate_status == TaskStatus.XEVALUATEFAIL)
    {
        document.getElementById('btn_evaluate_task_info').value = "启动评估";
        alert("评估失败，详细信息:\n" + http_request.responseText);
    }
    else if(str_evaluate_status == TaskStatus.XEVALUATING)
    {
        if(g_evaluate_task_wait_times <= 10)
        {
            setTimeout(function(){get_evaluate_result(str_task_id);}, 3000);
        }
    }
    else
    {
        if(g_evaluate_task_wait_times <= 10)
        {
            setTimeout(function(){get_evaluate_result(str_task_id);}, 3000);
        }
    }
}

//导出任务模型
function export_model(obj)
{
    //任务id
    var obj_export_task_id = document.getElementById('evaluate_export_task_id');
    var str_export_task_id = obj_export_task_id.value;
    
    //导出路径
    var str_model_save_path = "";
    var obj_model_save_path = document.getElementById('export_model_path_text');
    str_model_save_path = obj_model_save_path.value;
    
    var http_request;
    if (window.XMLHttpRequest)
    {
        http_request=new XMLHttpRequest();
    }
    else
    {
        http_request=new ActiveXObject("Microsoft.XMLHTTP");
    } 
    http_request.onreadystatechange=function()
    {
        if (http_request.readyState==4)
        {
            if (http_request.status==200)
            {
                //获取URL并打开
                alert("导出成功! 模型保存路径：" + str_model_save_path);
                //追加到导出模型列表
                var str_project_id = "";
                var obj_task_project_id = document.getElementById('evaluate_export_task_project_id');
                str_project_id = obj_task_project_id.value;
                
                var model_data = {"pid":str_project_id,"tid":str_export_task_id,"name":str_export_task_id + "_export_model","type":"exported","source_path":"","path":str_model_save_path,"exported_type":0,"eval_results":{}};
                var model_http_request = new XMLHttpRequest();
                model_http_request.open("POST", str_srv_url + "/model", false);
                model_http_request.setRequestHeader("Content-type","application/json");
                model_http_request.send(JSON.stringify(model_data));
            }
            else
            {
                alert("导出失败，请检查服务器配置\n" + http_request.responseText);
            }
        }
    }

    //默认epoch为自动获取最优
    var data = {"tid":str_export_task_id,"type":"infer","save_dir":str_model_save_path,'quant': false};
    http_request.open("POST", str_srv_url + "/project/task/export", true);
    http_request.setRequestHeader("Content-type","application/json");
    http_request.send(JSON.stringify(data));
}

//联系方式
function contact_us()
{
    alert("PaddleX QQ群：1045148026");
}

//刷新按纽
function refresh_contents(obj)
{
     if(obj.value == "刷新项目信息")
     {
         load_projects(obj);
     }
     else if (obj.value == "刷新数据集信息")
     {
         load_datasets(obj);
     }
     else if (obj.value == "刷新所有任务信息")
     {
         load_tasks(obj);
     }
     else if (obj.value == "刷新项目任务信息")
     {
         load_project_tasks(g_view_project_task_id);
     }
     else if (obj.value == "刷新模型信息")
     {
         load_models(obj);
     }
     else
     {
         load_projects(obj);
     }
}

//项目对象右键弹出菜单
function show_project_popupmenu(obj)
{
    var obj_project_id = document.getElementById('popup_menu_project_id');
    obj_project_id.value = obj.id;

    var menu = document.getElementById('popupmenu_project');  
    menu.style.display = 'block';
    menu.style.left =  document.documentElement.scrollLeft + document.body.scrollLeft+ window.event.clientX + 'px';
    menu.style.top = document.documentElement.scrollTop + document.body.scrollTop+ window.event.clientY + 'px';
    window.event.returnValue=false;
    window.event.cancelBubble=true;
    window.event.preventDafault();
    window.event.stopPropagation();
    return false;
}

//数据集对象右键弹出菜单
function show_dataset_popupmenu(obj)
{
    var obj_dataset_id = document.getElementById('popup_menu_dataset_id');
    obj_dataset_id.value = obj.id;
    var menu = document.getElementById('popupmenu_dataset');  
    menu.style.display = 'block';
    menu.style.left =  document.documentElement.scrollLeft + document.body.scrollLeft+ window.event.clientX + 'px';
    menu.style.top = document.documentElement.scrollTop + document.body.scrollTop+ window.event.clientY + 'px';
    window.event.returnValue=false;
    window.event.cancelBubble=true;
    window.event.preventDafault();
    window.event.stopPropagation();
    return false;
}

//任务对象右键弹出菜单
function show_task_popupmenu(obj)
{
    var obj_task_id = document.getElementById('popup_menu_task_id');
    obj_task_id.value = obj.id;
    var menu = document.getElementById('popupmenu_task');
    menu.style.display = 'block';
    menu.style.left =  document.documentElement.scrollLeft + document.body.scrollLeft+ window.event.clientX + 'px';
    menu.style.top = document.documentElement.scrollTop + document.body.scrollTop+ window.event.clientY + 'px';
    window.event.returnValue=false;
    window.event.cancelBubble=true;
    window.event.preventDafault();
    window.event.stopPropagation();
    return false;
}

//任务对象右键弹出菜单
function show_models_popupmenu(obj)
{
    var obj_model_id = document.getElementById('popup_menu_model_id');
    obj_model_id.value = obj.id;
    var menu = document.getElementById('popupmenu_model');  
    menu.style.display = 'block';
    menu.style.left =  document.documentElement.scrollLeft + document.body.scrollLeft+ window.event.clientX + 'px';
    menu.style.top = document.documentElement.scrollTop + document.body.scrollTop+ window.event.clientY + 'px';
    window.event.returnValue=false;
    window.event.cancelBubble=true;
    window.event.preventDafault();
    window.event.stopPropagation();
    return false;
}

//隐藏右键菜单
document.onclick = function()
{
    var menu = document.getElementById('popupmenu_project');
    menu.style.display = 'none';
    var obj_project_id = document.getElementById('popup_menu_project_id');
    obj_project_id.value = "";
    
    menu = document.getElementById('popupmenu_dataset');
    menu.style.display = 'none';
    var obj_dataset_id = document.getElementById('popup_menu_dataset_id');
    obj_dataset_id.value = "";
    
    menu = document.getElementById('popupmenu_task');
    menu.style.display = 'none';
    var obj_task_id = document.getElementById('popup_menu_task_id');
    obj_task_id.value = ""; 

    menu = document.getElementById('popupmenu_model');
    menu.style.display = 'none';
    var obj_model_id = document.getElementById('popup_menu_model_id');
    obj_model_id.value = "";
}

//设置远端服务器地址
function set_server_addr(input_data)
{
    var input_srv_url = document.getElementById('server_url_text');
    str_srv_url = input_srv_url.value;
    
    var last_pos = str_srv_url.length - 1;
    var last_char = str_srv_url.charAt(last_pos);
    
    if(last_char == '/')
    {
        str_srv_url = str_srv_url.substring(0, (str_srv_url.length - 1));
    }
    
    var http_request = new XMLHttpRequest();
    http_request.onreadystatechange=function()
    {
        
        if (http_request.readyState==4)
        {
            if (http_request.status==200)
            {
                 str_json = http_request.responseText;
                 var obj_json = eval('(' + str_json + ')');
                 var str_workspace_dir = obj_json["dirname"];
                 alert("设置成功！\n服务器地址：" + str_srv_url + "\n服务器工作区路径：" + str_workspace_dir);
                 
                 hide_server_info(null);
                 load_projects();
            }
            else
           {
                alert("设置失败，服务器连接失败，请检查服务器地址是否正确！" + http_request.responseText)
            }
        }
    }

    http_request.open('GET', str_srv_url + "/workspace", true);
    http_request.send(null);
}

//获取服务器系统信息
function get_server_system_info(str_info_type = "machine_info")
{
    var http_request = new XMLHttpRequest();

    http_request.open('GET', str_srv_url + "/system?type=" + str_info_type, false);
    http_request.send(null);
    
    return http_request.responseText;
}

//获取工作区所有项目信息
function load_projects()
{
    update_nav_bar(Nav_Bar_Type_Enum["projects"]);
    var http_request;
    if (window.XMLHttpRequest)
    {
        http_request=new XMLHttpRequest();
    }
    else
    {
        http_request=new ActiveXObject("Microsoft.XMLHTTP");
    } 
    http_request.onreadystatechange=function()
    {
        if(http_request.readyState==4 && http_request.status==200)
        {
            //更新表格内容
            fill_table_contents(http_request.responseText, "project");
        }
        else
        {
            fill_table_with_error();
        }
    }
    http_request.open("GET",str_srv_url + "/project",true);
    http_request.send(null);
}

//创建项目
function create_project(input_data)
{
    var input_prj_name = document.getElementById('project_name_text');
    var input_prj_type = document.getElementById('project_type_text');
    var input_prj_desc = document.getElementById('project_desc_text');
    var input_prj_dataset = document.getElementById('create_project_dataset_id_text');
    
    var str_prj_name = input_prj_name.value;
    var str_prj_type = input_prj_type.value;
    var str_prj_desc = input_prj_desc.value;
    var str_prj_dataset_id = input_prj_dataset.value;
    
    if(str_prj_name == "")
    {
        alert("请输入项目名称");
        return;
    }
    
    if(str_prj_dataset_id == 0)
    {
        alert("请选择项目对应数据集或者创建数据集");
        return;
    }
    
    var http_request = new XMLHttpRequest();
    http_request.onreadystatechange=function()
    {
        if (http_request.readyState==4)
        {
            if (http_request.status==200)
            {
                 str_json = http_request.responseText;
                 alert("项目创建成功！\n" + str_json);
                 var obj_json = eval('(' + str_json + ')');
                 var str_new_pid = obj_json["pid"];
                 
                 //绑定数据集
                 var attr_dict = {'did': str_prj_dataset_id};
                 var bind_params = {'struct': 'project', 'id': str_new_pid, 'attr_dict': attr_dict}
                 var bind_http_request = new XMLHttpRequest();
                 bind_http_request.open("PUT", str_srv_url + "/workspace", false);
                 bind_http_request.setRequestHeader("Content-type","application/json");
                 bind_http_request.send(JSON.stringify(bind_params));
                 
                 hide_create_prj_win_modal();
                 load_projects();
            }
            else
            {
              alert("项目创建失败，请检查服务器配置" + http_request.responseText);
            }
        }
    }

  
    var data = {"name":str_prj_name,"desc":str_prj_desc,"project_type":str_prj_type};
    http_request.open("POST", str_srv_url + "/project", true);
    http_request.setRequestHeader("Content-type","application/json");
    http_request.send(JSON.stringify(data));
}

//对某个字段排序
function sort_compare(sort_field, sort_type = "asc")
{
    return function(a,b)
    {
        if(sort_type == "asc")
        {
            return a[sort_field].localeCompare(b[sort_field]);
        }
        else
        {
            return b[sort_field].localeCompare(a[sort_field]);
        }
    }
}

//查看一个项目
function show_project(data)
{
    g_view_project_task_id = data.id;
    g_view_project_task_type = document.getElementById("view_project_type_" + g_view_project_task_id).value;
    g_view_project_task_name = document.getElementById("view_project_name_" + g_view_project_task_id).value;
    //查看项目下的任务
    load_project_tasks(data.id);
}

//获取工作区所有数据集信息
function load_datasets()
{
    update_nav_bar(Nav_Bar_Type_Enum["datasets"]);
    var http_request;
    if (window.XMLHttpRequest)
    {
        http_request=new XMLHttpRequest();
    }
    else
    {
        http_request=new ActiveXObject("Microsoft.XMLHTTP");
    } 
    http_request.onreadystatechange=function()
    {
        if(http_request.readyState==4 && http_request.status==200)
        {
            //更新表格内容
            fill_table_contents(http_request.responseText, "dataset");
        }
        else
        {
            fill_table_with_error();
        }
    }
    http_request.open("GET",str_srv_url + "/dataset",true);
    http_request.send(null);
}

//获取所有任务信息
function load_tasks()
{
    document.getElementById("btn_refresh").value = "刷新所有任务信息";
    document.getElementById("table_create_new").style.display = "none";
    update_nav_bar(Nav_Bar_Type_Enum["tasks"]);
    
    var http_request;
    if (window.XMLHttpRequest)
    {
        http_request=new XMLHttpRequest();
    }
    else
    {
        http_request=new ActiveXObject("Microsoft.XMLHTTP");
    }
    http_request.onreadystatechange=function()
    {
        if(http_request.readyState==4 && http_request.status==200)
        {
            //更新表格内容
            fill_table_contents(http_request.responseText, "task");
        }
        else
        {
            fill_table_with_error();
        }
    }
    http_request.open("GET",str_srv_url + "/project/task",true);
    http_request.send(null);
}

//获取项目下的任务
function load_project_tasks(str_project_id)
{
    document.getElementById("btn_refresh").value = "刷新项目任务信息";
    document.getElementById("table_create_new").style.display = "block";
    document.getElementById("btn_create_new").value = "新建任务";
    update_nav_bar(Nav_Bar_Type_Enum["project_tasks"]);
    
    var http_request;
    if (window.XMLHttpRequest)
    {
        http_request=new XMLHttpRequest();
    }
    else
    {
        http_request=new ActiveXObject("Microsoft.XMLHTTP");
    } 
    http_request.onreadystatechange=function()
    {
        if(http_request.readyState==4 && http_request.status==200)
        {
            //更新表格内容
            fill_table_contents(http_request.responseText, "task");
        }
        else
        {
            fill_table_with_error();
        }
    }
    http_request.open("GET",str_srv_url + "/project/task?pid=" + str_project_id,true);
    http_request.send(null);
}

//创建数据集
function create_dataset(input_data)
{
    var http_request = new XMLHttpRequest();
    http_request.onreadystatechange=function()
    {
        if (http_request.readyState==4)
        {
            if (http_request.status==200)
            {
                 alert("数据集创建成功！\n" + http_request.responseText);
                 hide_create_dataset_win_modal();
                 load_datasets();
            }
            else
            {
                alert("数据集创建失败，请检查服务器配置" + http_request.responseText);
            }
        }
    }
    var input_dataset_name = document.getElementById('dataset_name_text');
    var input_dataset_type = document.getElementById('dataset_type_text');
    var input_dataset_desc = document.getElementById('dataset_desc_text');
    
    var str_dataset_name = input_dataset_name.value;
    var str_dataset_type = input_dataset_type.value;
    var str_dataset_desc = input_dataset_desc.value;
    
    if(str_dataset_name == "")
    {
        alert("请输入数据集名称");
        return;
    }
    
    var data = {"name":str_dataset_name,"desc":str_dataset_desc,"dataset_type":str_dataset_type};
    
    http_request.open("POST", str_srv_url + "/dataset", true);
    http_request.setRequestHeader("Content-type","application/json");
    http_request.send(JSON.stringify(data));
}

//导入数据集
function import_dataset(obj)
{
    var http_request = new XMLHttpRequest();
    http_request.onreadystatechange=function()
    {
        if (http_request.readyState==4)
        {
            if (http_request.status==200)
            {
                 alert("数据集导入成功！\n" + http_request.responseText);
                 hide_import_dataset_win_modal(obj);
                 load_datasets();
            }
            else
            {
                alert("数据集导入失败，请检查服务器配置" + http_request.responseText);
            }
        }
    }
    
    var obj_import_dataset_id = document.getElementById('import_dataset_id');
    str_import_dataset_id = obj_import_dataset_id.value;
    
    var input_dataset_path = document.getElementById('import_dataset_path_text');

    var str_dataset_path = input_dataset_path.value;
    
    if(str_dataset_path == "")
    {
        alert("请输入数据集路径");
        return;
    }
    
    var data = {"did":str_import_dataset_id,"path":str_dataset_path};

    http_request.open("PUT", str_srv_url + "/dataset", true);
    http_request.setRequestHeader("Content-type","application/json");
    http_request.send(JSON.stringify(data));
}

//切分数据集
function split_dataset(obj)
{
    var http_request = new XMLHttpRequest();
    http_request.onreadystatechange=function()
    {
        if (http_request.readyState==4)
        {
            if (http_request.status==200)
            {
                 alert("数据集切分成功!\n" + http_request.responseText);
                 hide_split_dataset_win_modal(obj);
                 load_datasets();
            }
            else
            {
                alert("数据集切分失败，请检查服务器配置" + http_request.responseText);
            }
        }
    }
    
    var obj_split_dataset_id = document.getElementById('split_dataset_id');
    var str_split_dataset_id = obj_split_dataset_id.value;

    var obj_split_dataset_var_percent = document.getElementById('split_dataset_val_percent');
    var val_split = obj_split_dataset_var_percent.value/100;
    
    var obj_split_dataset_test_percent = document.getElementById('split_dataset_test_percent');
    var test_split = obj_split_dataset_test_percent.value/100;
    
    var data = {"did":str_split_dataset_id, "val_split":val_split, "test_split":test_split};

    //alert(JSON.stringify(data));
    
    http_request.open("PUT", str_srv_url + "/dataset/split", true);
    http_request.setRequestHeader("Content-type","application/json");
    http_request.send(JSON.stringify(data));
}

//获取所有导出模型
function load_models()
{
    update_nav_bar(Nav_Bar_Type_Enum["models"]);
    
    var http_request;
    if (window.XMLHttpRequest)
    {
        http_request=new XMLHttpRequest();
    }
    else
    {
        http_request=new ActiveXObject("Microsoft.XMLHTTP");
    } 
    http_request.onreadystatechange=function()
    {
        if(http_request.readyState==4 && http_request.status==200)
        {
            //更新表格内容
            fill_table_contents(http_request.responseText, "models");
        }
        else
        {
            fill_table_with_error();
        }
    }
    http_request.open("GET",str_srv_url + "/model?type=exported",true);
    http_request.send(null);
}

//填充对象信息到表格(项目/数据集/任务/模型)
function fill_table_contents(list_contents, type = "project")
{
    if(type == "project")
    {
        document.getElementById("btn_refresh").value = "刷新项目信息";
        document.getElementById("table_create_new").style.display = "block";
        document.getElementById("btn_create_new").value = "新建项目";
    
        rows = table_contents.rows.length;
        for (i=0;i<rows;i++) 
        { 
            table_contents.deleteRow(i); 
            rows=rows-1; 
            i=i-1; 
        }

        rows = table_contents.rows.length;
        var newTr=table_contents.insertRow(rows);
        var str_json = eval('(' + list_contents + ')');
        var obj_prjs = str_json["projects"];
        count_prj = Object.keys(obj_prjs).length;
        col_count = 1;

        //项目为空
        if(count_prj <= 0)
        {
            var newTd0=newTr.insertCell();
            var str_html = "<div id=\"draw-border\"><view_item id=\"btn_create\" onclick=\"show_download_demo_win_modal(this)\" style=\"width: 510px; height: 90px; align: center\">";
            str_html = str_html + "<br><font color=\"blue\">暂无项目，点击下载示例项目（或点击新建按纽创建新项目）</font>";
  
            str_html = str_html + "</view_item></div>";
            newTd0.innerHTML = str_html;
            return;
        }
        
        obj_prjs.sort(sort_compare('id'));
        for(var p in obj_prjs)
        {
            str_id = obj_prjs[p].id;
            str_attr = obj_prjs[p].attr;
            str_name = str_attr["name"];
            str_desc = str_attr["desc"];
            str_type = str_attr["type"];
            str_crttime = str_attr["create_time"];

            var newTd0=newTr.insertCell();
            var str_html = "";
  
            str_html = "<div id=\"draw-border\" style=\"word-wrap: break-word;\"><view_item onclick=\"show_project(this)\" oncontextmenu=\"javascript:show_project_popupmenu(this);\" id=\"" + str_id + "\">";
            str_html = str_html + "项目名称：" + str_name + " (" + str_id + ")" + "<br>" + "<input type=\"hidden\" id=\"view_project_name_" + str_id + "\" value=\"" + str_name + "\">";
            
            if(str_type == "classification")
                str_type_view = "<font color=\"green\">图像分类</font>";
            else if(str_type == "detection")
                str_type_view = "<font color=\"purple\">目标检测</font>";
            else if(str_type == "instance_segmentation")
                str_type_view = "<font color=\"orange\">实例分割</font>";
            else if(str_type == "segmentation")
                str_type_view = "<font color=\"red\">语义分割</font>";
                
            //如下所示，后续如果要获取对象数据，可以在此处放hidden input，后续再通过id获取
            str_html = str_html + "项目类型：" + str_type_view + "<br>" + "<input type=\"hidden\" id=\"view_project_type_" + str_id + "\" value=\"" + str_type + "\">";
            str_html = str_html + "项目描述：" + str_desc + "<br><br>";
            str_html = str_html + "创建时间：" + str_crttime + "<br>";
            str_html = str_html + "</view_item></div>";
            newTd0.innerHTML = str_html;
      
            if(col_count == 5)
            {
                rows = table_contents.rows.length;
                newTr=table_contents.insertRow(rows);
                col_count = 1;
            }
            else
            {
                col_count = col_count + 1;
            }
        }
    }
    else if(type == "dataset")
    {
        document.getElementById("btn_refresh").value = "刷新数据集信息";
        document.getElementById("table_create_new").style.display = "block";
        document.getElementById("btn_create_new").value = "新建数据集";
    
        rows = table_contents.rows.length;
        for (i=0;i<rows;i++) 
        { 
            table_contents.deleteRow(i); 
            rows=rows-1; 
            i=i-1; 
        }

        rows = table_contents.rows.length;
        var newTr=table_contents.insertRow(rows);
        var str_json = eval('(' + list_contents + ')');
        var obj_datasets = str_json["datasets"];
        count_datasets = Object.keys(obj_datasets).length;
        col_count = 1;

        //数据集为空
        if(count_datasets <= 0)
        {
            var newTd0=newTr.insertCell();
            var str_html = "<div id=\"draw-border\"><view_item id=\"btn_create\" onclick=\"show_create_dataset_win_modal(this)\" style=\"width: 260px; height: 90px; align: center\">";
            str_html = str_html + "<br><font color=\"blue\">暂无数据集，点击创建数据集</font>";

            str_html = str_html + "</view_item></div>";
            newTd0.innerHTML = str_html;
            return;
        }
        
        obj_datasets.sort(sort_compare('id'));
        for(var p in obj_datasets)
        {
            str_id = obj_datasets[p].id;
            str_attr = obj_datasets[p].attr;
            str_name = str_attr["name"];
            str_desc = str_attr["desc"];
            str_type = str_attr["type"];
            str_crttime = str_attr["create_time"];
            str_status = str_attr["dataset_status"];
            str_dataset_path = str_attr["path"];

            //增加状态显示以及对应
